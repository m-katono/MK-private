<!DOCTYPE html>
<html lang="ja" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="./css/master.css" type="text/css">
        <title>MK-private</title>
    </head>
    <body>
        <div class="top_menu">
                <a href="#top" class="pagenum">top</a>-<a href="./index.html#menu" class="pagenum">menu</a>
        </div>

        <div class="top" id="top">
		<p><iframe width="400" height="30" frameborder="0"></iframe></p>

<!--タイトル-->
        <h1><a href="https://shangyuanyezhengju.wixsite.com/mkpage" target="_blank" rel="noopener"><img src="./photo/icon.jpg" alt="" width="40px" height="40px"></a><a href="https://m-katono.mydns.jp">MK-private</a></h1>

        <div class="menu"><h2>Page 5</h2>
        Page-<a href="./index.html#menu" class="pagenum">menu</a>-<a href="./index.html" class="pagenum">1</a>-<a href="./second-page.html" class=pagenum>2</a>-<a href="./third-page.html" class="pagenum">3</a>-<a href="./fourth-page.html" class="pagenum">4</a>-5-
        <p>
            　Puppy Linuxが快適すぎてやめられない。機能は決して豊富ではないけど軽快な動作が素晴らしい。
        </p>
        </div>

        <div class="menu" id="i21">
            <h3>Puppy Linuxチョー快適</h3>03/Mar/2020
            <p>
                　Puppy Linuxを使い始めてから何日か経過したけどチョー快適。手持ちのノートPC全てで起動できることが確認できたし、会社のPCでも大丈夫だった。最初は１０年前のNEC VersaProだとハードウェアを認識できておらずインターネットに接続できなかったが、いつの間にか繋がるようになった。ネットでドライバを探してもすでにメーカーのWebサイトがリンク切れになっていて諦めていたのでとても嬉しかった。
            </p>
            <img src="./photo/screenshot-puppy.png" alt="puppy desktop" width="600px" oncontextmenu="return false;">
            <p>
                　慣れてきたのでデスクトップのアイコンを減らしたり、デザインを変えたりしながら楽しんでいる。本当はUbuntuで使っているソフトを使いたい場面もあるが、Puppyのサイズが大きくなってはつまらないのでやめておく。パッケージ管理についてはなかなか慣れない。ターミナル上から<strong>apt</strong>を使ってインストールしたりアップデートしたりに慣れてしまうと、GUIでの管理がめんどくさくなってしまう。
            </p>
           <p>
                　基本的には標準のソフトをメインに使って、最低限のコマンドだけインストールして使うつもりだったため2GBのパーティションにインストールしてしまったのですぐに足りなくなりそう。Vim、Python3.6、Tmux、sshfs、testdisk(含Photorec)しかインストールしていないがすでに1.4GBになっている。日本語化のファイルもなかなかの重量級。今後はこれ以上肥大化しないように気をつけながら使いたい。
            </p>
        </div>
<!--Raspberry pi 3B+の調子が悪い-->
	<div class="menu" id="i22">
		<h3>Raspberry pi 3B+の調子が悪い</h3>08/Mar/2020
		<p>
		　Raspberry pi 3B+が起動しなくなってしまった。たいしたことには使っていなかったが、不要になった2.5インチHDDをケースに入れてUSBで繋いでNAS的な感じで使っていた。久しぶりに<code class="coding-env">sudo apt update</code>をした後に再起動したら、ネットワーク上からアクセスできなくなってしまった。sshでも繋がらない。はじめはネットワークの設定の問題かと思ってモニターとキーボードを繋いで起動したところ、起動画面で<strong>'boot.main'</strong>と表示されて止まっている。幸い<strong>'Ctrl+Alt+T'</strong>でコンソール画面に入れたので<strong>'startx'</strong>でXwindowを起動したが、シングルユーザーモードになってしまった。
		</p>
		<p>
		　まずはやっぱりネットワークかと思って<strong>'/etc/dhcpcd.conf'</strong>を確認してみたが、特に変わったところはないように見える。そういえばいつも画面の右上に「稲妻マーク」が出ていたので、USBで繋いだHDDへの電源供給が足りていないのには気づいていたが、起動時にマウントするはずのHDDはマウントされていなかった。<code class="coding-env">sudo fdist -l</code>とか<code class="coding-env">lsusb</code>で確認したが、全く認識されていない様子。ためしに<strong>'/etc/fstab'</strong>の設定に<strong>nofail</strong>を追加したら起動できた。取り外したHDDを別のPCにつなぐと正常に動作するので、やっぱり電力不足で認識しなくなったみたい。アップデートUSB周りの動作が変わったのかもしれない。
		</p>
		<p>
		　<strong>samba</strong>でファイル共有できないと結構めんどくさいことになる。小さいデータはGoogleDriveやOneDriveでやり取りすればよいが、大きめのデータは扱いづらい。HDDは取り外して別の用途に使うことにして、代わりに手元に余っていた64GBのUSBメモリを繋いで設定した。HDDと違って寿命が心配なので長期間のバックアップ用としては使えないが、一時的にデータを保存しておくための外部ストレージ的に使うことにした。スマホやPCからガシガシとファイルを保存して、後でまとめてHDDにバックアップすれば良いかもしれない。
		</p>
		<p>
		<mark>10/Mar/2020　追記</mark><br>
		　<code class="coding-env">sudo apt update</code>をした後で、何故か有線LANが不通になってしまった。<strong>SSH</strong>でログインして作業していたのでwi-fiをオフにしたらシャットダウンもできなくなってしまった。かなり嫌だったが、シャットダウンせずに遠隔で電源をオフにした。家に帰ってから色々調べたがなかなか分からず困ってしまった。特に今回は外付けHDDの電力不足でOSを起動できなかったのと重なったので、最初はそれぞれ別の事象であることに気づかなかった。結果的にはいつも<strong>eth0</strong>だったNIC名が勝手に長い名前に変わっていて、<strong>/etc/dhcpcd.conf</strong>に書いた設定と合わなくなったのが原因っぽい。
		</p>
	</div>
<!--Raspberry pi 3B+が重い-->
    <div class="menu" id="i23">
        <h3>Raspberry pi 3B+が重い</h3>11/Mar/2020
        <p>
            　最近またラズパイをいじり始めたが、やたら動作が重いのが気になる。起動してChromiumでYouTUBEを再生し始めるとすぐに<strong>swap</strong>領域を使い始める。CPUの負荷はまだ余裕があるので、このリソース不足が原因い違いない。何とかならないものか。
        </p>
        <p>
            　考えてみるとYouTUBEの再生やWebサイトの閲覧なんかはスマホを使った方がよっぽど快適なので、わざわざラズパイで動かしてVNCでリモート接続する必要はない。モニターもキーボードも付けていない状態でファイルサーバーとして動かしているだけなので、GUIが必要な場面など皆無。セキュリティーを考えて<strong>samba</strong>にはLAN内からしかつながらないようにしているが、外でどうしてもファイルを取り出したいときには<strong>scp</strong>コマンドを使えばいい。
        </p>
        <p>
            　ということで、CLIで起動することにした。設定はGUIの<strong>Raspberry piの設定</strong>からもできるが、<code class="coding-env">sudo raspi-config</code>からやった。メニューに書いてある通りに選択していくだけなので簡単(英語)。
        </p>
        <img src="./photo/raspi-config.png" width="600" alt="raspi-config" oncontextmenu="return false;">
        <img src="./photo/top.png" width="600" alt="top command" oncontextmenu="return false;">
        <p>
            　こんな感じで<code>top</code>コマンドを使ってメモリの使用量を確認してみるとかなり余裕があるのが分かる。<strong>swap</strong>を使うこともなくなりそうなので、SDカードが長持ちするかもしれない。
        </p>
    </div>
<!--Raspberry pi 3B+にファンを付けた-->
    <div class="menu" id="i24">
        <h3>Raspberry pi 3B+にファンを付けた</h3>12/Mar/2020
        <p>
            　GUIで使用しているときには強く感じるのだが、ちょっと負荷がかかるとすぐに動作が重くなるような気がする。リソース不足のせいだと思っていたけど、ネットで調べてみると温度上昇によるCPUのクロック周波数の低下が影響している模様。確かに起動して数分でかなり熱くなるので心配ではあった。
        </p>
        <p>
            　ちなみに、今までは温度についてあまり気にしていなかったので比較対象がないが、起動から数分のCPU温度が大体30°C、負荷がかかっているときには60°Cを超えると思う（気温14°C、湿度49%）。夏場の高負荷時には80°Cを超えるだろう。ABOXのキットに付いてきたケースを使っているため空きスペースが小さいので、ラズパイ向けの2.5cm薄型ファン（5V 0.15A）を注文した。電子部品屋さんが近くにあれば100円くらいで買えそうだが、田舎に住んでいるのでネット通販で送料込み551円で取り寄せた。<br>
            <br>
            <a href="https://store.shopping.yahoo.co.jp/sky-group/10959.html" target="_blank" rel="noopener">CPU 冷却ファン DC 5V ブラシレス ラズベリーパイ モデルB Pi 2用 ネジ付 修理 交換 冷却パーツ</a>
        </p>
        <img src="./photo/fan_top.jpg" width="600" alt="Raspberry pi" oncontextmenu="return false;">
        <img src="./photo/fan_under.jpg" width="600" alt="fan" oncontextmenu="return false;">
        <p>
            　ファンの大きさに合わせてケースの蓋に穴を開けて付属のボルト＆ナットで取り付けた。GPIOピンの配置は公式ドキュメントの画像ですぐに分かる。図で言うと4番に＋、6番にーの線でオーケー。電源ONとともに無事に作動した。
        </p>
        <img src="./photo/gpio.png" width="600" alt="gpio" oncontextmenu="return false;">
        <p>
            　せっかくファンを付けたので負荷時の温度を計ってみたい。GUIは使っていないのでコマンドラインで負荷をかける方法を調べたら<strong>stress</strong>コマンドを使っている例が多かったが、わざわざこのためだけに新たにインストールするのは嫌だ。そのままネットサーフィンしていたら標準で<strong>yes</strong>という変わったコマンドがあることが分かったので使ってみた。
<pre class="coding-env"><code>
$ yes > /dev/null

</code></pre>
            このまま15分くらい放置して温度を調べたら37°Cくらいまでしか上昇していなかった。夏場でも60°C以下に収まりそうな気がするので気持ちが落ち着く。CPU温度を調べるときは下のどちらかを使う人が多い。catの方は1000倍の数字で表示される。
<pre class="coding-env"><code>
$ vcgencmd measure_temp

$ cat /sys/class/thermal/chermal_zone0/temp

</code></pre>
        </p>
        <img src="./photo/cpu_temp.png" width="600" alt="cpu temp" oncontextmenu="return false;">
    </div>
<!--LinuxでPPPoE接続してみる-->
    <div class="menu" id="i25">
	    <h3>Puppy LinuxでPPPoE接続してみる</h3>14/Mar/2020
	<p>
	    　自宅のネット環境はフレッツ光＋OCNで、ブロードバンドルーターでWi-Fi環境を整えている。今のところは何の問題もないがいつかルーターを買い換えたり、調子が悪くなって再設定する必要があるかも知れない。でも、契約時に送られてきた書類をなくしてしまったので接続時に使うパスワードが分からなくなってしまった。ISPに連絡して書類を再発行してもらえば簡単だが、それではつまらないので自分で調べることにする。LAN内のPCのブラウザからルーターの設定画面に入ってPPPoE接続の現在の設定の修正画面を開くと接続IDはすぐに分かる。パスワードは伏せ字になっていて読めない。伏せ字を読めるというフリーソフトを使ってみても読めない。仕方がないのでソースから地道に読んで調べたが、それが本当に合っているのか心配に思ったので確認することにした。LANケーブルをルーターから抜いて直接PCに差し、PPPoE接続してみれば分かる。Windowsではよく使っていたPPPoEなので簡単だが、せっかくなのでPuppyLinuxでやってみることにする。
	</p>
	<p>
	　LinuxでPPPoE接続はやったことが無いので1から調べた。ネット上には新旧の様々なディストリビューション向けの情報が入り乱れているので簡単には解決できない。以前のPuppyにはGUIで設定するツールがあったようだが、今はインストールされていなかった（ver8.0）。ざっと調べただけでも関係がありそうなコマンドは<code class="coding-env">adsl-setup</code>、<code class="coding-env">pppoe-setup</code>、<code class="coding-env">ifup</code>、<code class="coding-env">ifdown</code>、<code class="coding-env">ifconfig</code>、<code class="coding-env">ip addr</code>などなどたくさんあるし、設定ファイルも<strong>resolv.conf</strong>、<strong>pppoe.conf</strong>、<strong>dhcpcd.conf</strong>などディストロによって触るファイルが異なる。Puppyの場合は<mark>pppoeコマンド</mark>で設定や接続・切断をすればいいみたい。
	</p>
	<p>
	　Puppyの場合だけなのかLinux全般なのかは分からないが、<code class="coding-env">pppoe-setup</code>で色々と設定してさっそく<code class="coding-env">pppoe-start</code>でスターとしようとしてもエラーになる。まずは<strong>eth0</strong>を起動（？）してから<code class="coding-env">pppoe-start</code>しないとダメみたい。<strong>メニュー&gt;セットアップ&gt;インターネット接続ウィザード</strong>で<strong>eth0</strong>の接続をするとIPアドレスが割り振られている。そして<code class="coding-env">pppoe-stat</code>をすると<strong>Connected!</strong>と表示される。設定はこんな感じで進める。ちょっと長い。
	</p>
<pre class="coding-env"><code>
$pppoe-setup

Welcome to the Reoaring Penguin PPPoE client setup.  First, I will run
some checks on your system to make sure the PPPoE client is installed
properly...

Looks good!  Now, please enter some information:

USER NAME

&gt;&gt;&gt; Enter your PPPoE user name (default root):　　　　　　←←←プロバイダの接続ID

INTERFACE

&gt;&gt;&gt; Enter the Ethernet interface connected to the DSL modem
For Solaris, this is likely to be something like /dev/hme0.
For Linux, it will be ethn, where 'n' is a number.
(default eth0): eth0

Do you want the link to come up on demand, or stay up continuously?
If you want it to come up on demand, enter the idle time in seconds
after which the link should be dropped.  If you want the link to
stay up permanently, enter 'no' (two letters, lower-case.)
NOTE: Demand-activated links do not interact well with dynamic IP
addresses.  You may have some problems with demand-activated links.
&gt;&gt;&gt; Enter the demand value (default no): no　　　　　　　←←←私は'no'

DNS

Please enter the IP address of your ISP's primary DNS server.
If your ISP claims that 'the server will provide DNS addresses',
enter 'server' (all lower-case) here.
If you just press enter, I will assume you know what you are
doing and not modify your DNS setup.
&gt;&gt;&gt; Enter the DNS information here: XXX.XXX.XXX.XXX　　　　←←←プライマリDNSアドレスを入力
Please enter the IP address of your ISP's secondary DNS server.
If you just press enter, I will assume there is only one DNS server.
&gt;&gt;&gt; Enter the secondary DNS server address here: YYY.YYY.YYY.YYY　←←←セカンダリDNSアドレス

PASSWORD

&gt;&gt;&gt; Please enter your PPPoE password:                      ←←←パスワードを2回入力
&gt;&gt;&gt; Please re-enter your PPPoE password: 

FIREWALLING

Please choose the firewall rules to use.  Note that these rules are
very basic.  You are strongly encouraged to use a more sophisticated
firewall setup; however, these will provide basic security.  If you
are running any servers on your machine, you must choose 'NONE' and
set up firewalling yourself.  Otherwise, the firewall rules will deny
access to all standard servers like Web, e-mail, ftp, etc.  If you
are using SSH, the rules will block outgoing SSH connections which
allocate a privileged source port.


The firewall choices are:
0 - NONE: This script will not set any firewall rules.  You are responsible
for ensuring the security of your machine.  You are STRONGLY
recommended to use some kind of firewall rules.
1 - STANDALONE: Appropriate for a basic stand-alone web-surfing workstation
2 - MASQUERADE: Appropriate for a machine acting as an Internet gateway
for a LAN
&gt;&gt;&gt; Choose a type of firewall (0-2): 0                    ←←←ファイアーウォールの設定

** Summary of what you entered **

Ethernet Interface: eth0
User name:          接続ID
Activate-on-demand: No
Primary DNS:        XXX.XXX.XXX.XXX
Secondary DNS:      YYY.YYY.YYY.YYY
Firewalling:        NONE

&gt;&gt;&gt; Accept these settings and adjust configuration files (y/n)? y
Adjusting /etc/ppp/pppoe.conf
Adjusting /etc/resolv.conf
/usr/sbin/pppoe-setup: line 318: /etc/resolv.conf: Too many levels of symbolic links
/usr/sbin/pppoe-setup: line 319: /etc/resolv.conf: Too many levels of symbolic links
/usr/sbin/pppoe-setup: line 321: /etc/resolv.conf: Too many levels of symbolic links
Adjusting /etc/ppp/pap-secrets and /etc/ppp/chap-secrets
(But first backing it up to /etc/ppp/pap-secrets-bak)
(But first backing it up to /etc/ppp/chap-secrets-bak)


Congratulations, it should be all set up!

Type 'pppoe-start' to bring up your PPPoE link and 'pppoe-stop' to bring
it down.  Type 'pppoe-status' to see the link status.

</code></pre>
	<p>
	    　この後、<code class="coding-env">pppoe-start</code>で接続して<code class="coding-env">pppoe-stop</code>で切断できた。最後の方の<strong>resolv.conf</strong>の読み込みがおかしいけどそのうち考える。最初はDNSの設定を<strong>server</strong>にしたけど自動で読み込めず、適当なDNSアドレスを入れたら名前解決できた。
	</p>
    </div>
<!--ここまでがTOP-->
        </div>
    </body>
</html>
