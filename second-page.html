<!DOCTYPE html>
<html lang="ja" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <!-- jQuery.jsの読み込み -->
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>

<!-- スムーズスクロール部分の記述 -->
<script type="text/javascript" src="./javascript/scroll.js"></script>
<!--スタイルシートを読み込み-->
<link rel="stylesheet" href="./css/master.css" type="text/css">
        <title>MK-private</title>
    </head>
    <body>
        <div class="top" id="top">
        <h1><a href="https://shangyuanyezhengju.wixsite.com/mkpage" target="_blank"><img src="./photo/icon.jpg" alt="" width="80px" height="80px"></a>MK-private</h1>
        <div class="menu"><h2>Page 2</h2>
            <a href="./index.html#menu" class="button">目次へ戻る</a><br>
            Page <a href="./index.html" class="pagenum">1</a> 2 <a href="./third-page.html" class="pagenum">3</a>
            <p>
                コードが長くなるとスクロールが大変なので、５個記事を書いたら違うページに移動することにした。
            </p>
        </div>
<!--ここから記事-->
            <div class="menu" id="i6">
                <h3>Webページを微調整</h3>27/Jan/2020
                <p>
                　コツコツと記事を書いているとだんだんコードが縦長になってきてスクロールするのが大変なので、２ページ目に進めることにした。それに合わせていくつかの微調整をしたので記録。
                </p>
                <h4>アイコン画像を作成</h4>
                <p>
                    　ブラウザのタブやステータスバー、ブックマークに使用されるアイコン画像を作成した。何も置かないとブラウザ標準の画像（Chromeだと地球のマーク）が表示される。「ファビコン」と言って、サイトのルートディレクトリに「favicon.ico」のファイルを置いておけば良いらしい。.icoの拡張子のファイルはほぼ.pngのような物だが、作成できるソフトが限られているとのこと。いくつかのWebサービスやフリーソフトがあるらしいが、自分は全てのパソコンに<a href="https://www.gimp.org/" target="_blank">GIMP</a>をインストールしていて、それが.icoファイルの作成に対応していた。GIMPはPhotoShopに並ぶ高性能なソフトを無料で使えるということで人気のソフト。高機能すぎて使い方がわからないくらい。ただ、Linux上だとサクサク動くのにWindows上だと激重、Macだとその中間と言った感じ。
                </p>
                <h4>リンク先へスクロール</h4>
                <p>
                    　目次からそれぞれの記事へリンクを貼っているが、最近はカッコよくスクロールするサイトが多いので真似してみた。でもJavascriptはあまり知らないので、<a href="http://kyasper.com/jquery-tips/" target="_blank">こちらのサイト</a>から丸パクリさせていただいた。ありがとうございます。<mark>jQuery</marK>を読み込んで動きを指定するコードを書けば良いみたい。そのうちjQueryを使って動きのあるメニューなんかも作ってみたい。
                </p>
                <h4>httpsへリダイレクト</h4>
                <p>
                    　せっかくhttpsが使えるようになったので、httpへのアクセスをhttpsへリダイレクトすることにした。自分の場合は個人で学習・日記目的で運用しているサイトだし、今まで長らくhttpで運用していたわけでも無いので正直不要だが、やってみたかった。やり方としては「.htaccess」というファイルをサイトのルートディレクトリに入れておくらしく、<a href="https://keywordfinder.jp/blog/seo/http-https-redirect/" target="_blank">こちらのサイト</a>を参考にさせていただいた。ありがとうございます。内容はシンプル。
                </p>
		<blockquote>
			<p>
			RewriteEngine on<br>
			RewriteCond %{HTTPS} off<br>
			RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]<br>
			</p>
		</blockquote>
                <p>
                    この内容を.htaccessに書いてアップロードしておけば良いが、Windows上だと「.」から始まるファイル名は保存できないので、アップロードしてからファイル名を変更する。またはLinuxかMacで作った方が早い。
                </p>
                <h4>コード部分を見やすくする</h4>
                <p>
                    　ターミナル上で実行するコマンドやhtmlのコードは、コードっぽく見えるようにそれらしいスタイルにしたい。それには&lt;pre&gt;タグと&lt;code&gt;タグで囲む。
                </p>
                <pre class="coding-env"><code>
&lt;!-- htmlのコード -->
&lt;pre class="pretag"&gt;&lt;code&gt;
ここにコードを書く。
スペースやTABもそのまま表現される。
＜＞＆などはエスケープ文字で書く。
&lt;/code&gt;&lt;/pre&gt;
                </code></pre>
                <p>
                    preタグの中に「class="pretag"」と書いたので、それを使ってスタイルシートでスタイルを書く。
                </p>
                <pre class="coding-env"><code>
/* cssのコード */
.pretag    {
            color: #ffffff;  /* 文字色、whiteでもいい */
            background-color: #000000;  /* 背景色、blackでもいい */
            overflow: scroll; /* 飛び出る場合はスクロールを可能にする */
}
                </code></pre>
                <p>
                    シンタックスハイライトなんかもできるみたいだけど、それはまた今度にしようと思う。
                </p>
                <a href="./index.html#menu" class="button">目次へ戻る</a><br>
                <a href="#top" class="button">先頭へ</a>
            </div>
<!--Android用のテキストエディタ-->
            <div class="menu" id="i7">
                <h3>Android用のテキストエディタ</h3>28/Jan/2020
                <p>
                    　今日は仕事が終わってからスーパーへお弁当を買いに行った。一日中雨だったので余程売れ残ったのか、数種類のお弁当が一個１１０円で売られていた。ついつい３個も買ってしまったので明日は１日家に籠ることになりそう。
                </p>
                <p>
                    　そのお弁当と同じくらいのアプリをダウンロードした。余程気に入ったアプリにしか課金しないので、有料のアプリをダウンロードするのはかなり久しぶり。今回はAndroiｄ上で使うテキストエディタを買った。
                </p>
                <p>
                    　最近、MicrosoftWordやGoogleドキュメントのようなリッチテキストではなくてPlainTextを読み書きできるアプリの必要性を感じてきた。普段はTermux上のVimを使っているが、物理キーボードが無い環境では使いにくさを感じることが多い。Vimではカーソル移動・コピー・ペーストなどにキーボードを多用するが、ソフトウェアキーボードだととても操作しにくく、どうせ画面をタッチして操作するのであればVimである必要性は少なくなる。また、ソフトウェアキーボードだとコマンドだけでスマホのストレージ内のファイルまで移動するのが結構めんどくさい。すでにスマホ内にあるファイルはGUIのテキストエディタで書いた方が手っ取り早い。
                </p>
                <p>
                    　候補に上がったのはJota＋、QuickEdit、Droidvimの３つ。Doroidvimについては、先程の「タッチ操作ならVimじゃなくても」という考えで候補から外した。Playストアを見るとJota+とQuickEditは両方とも評価が高そうな感じ。Jota+は日本製っぽくて安心感があるけど、OSのバージョンに依存した不具合がありそうなように見える。QuickEditは目立った不具合はなさそうだけど、日本製じゃ無いので日本語化に違和感がありそう。
                </p>
                <p>
                    　ちょっぴり考えて、いきなりQuickEditの有料版をダウンロードした。値段は安いし「気に入らなかったら潔く諦めて違うのを使おう」くらいのノリ。実際に使って見るとかなり便利で、内部ストレージだけではなくGoogleDriveやOneDriveのファイルも直接編集できる。多くの言語でシンタックスハイライトできるし、検索・置き換え・エンコード変更などテキストエディタとして申し分ない作りになっていて気に入った。
                </p>
                <p>
                    こういうよく使うツールは人によって相性があると思うし、いろいろ使ってみて自分に合った物を選ぶのがベストだろうと思う。自分はQuickEditを気にってしまったので、しばらくは飽きることなく使えそう。
                </p>
                <a href="https://play.google.com/store/apps/details?id=com.rhmsoft.edit" target="_blank">QuickEdit</a><br>
                リンクはQuickEdit無料版のGooglePlay<br>
                <a href="./index.html#menu" class="button">目次へ戻る</a><br>
                <a href="#top" class="button">先頭へ</a>
            </div>
<!--Chromeでスクロールが変-->
            <div class="menu" id="i8">
                <h3>Chromeでスクロールがおかしい</h3>28/Jan/2020
                <p>
                    　先日ページ内でスクロールのアニメーションをするためにjQueryを使った。最初はスマホで気付いたのだが、ブラウザによってはちゃんとスクロールするものの、Chromeだとちゃんと動かなかった。「キャッシュが残ってるからかな？」くらいに思っていたが、PCでもChromeでは動かなかったので対策することにした。<br>今までのコードはこんな感じ。
                </p>
                <pre class="coding-env"><code>
1 &lt;!DOCTYPE html>
2 &lt;html lang="ja" dir="ltr">
3     &lt;head>
4         &lt;meta charset="utf-8">
5         &lt;meta name="viewport" content="width=device-width,initial-scale=1">
6         &lt;!-- jQuery.jsの読み込み -->
7         &lt;script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js">
8         &lt;/script>
9
10         &lt;!-- スムーズスクロール部分の記述 -->
11         &lt;script>
12         $(function(){
13            // #で始まるアンカーをクリックした場合に処理
14            $('a[href^=#]').click(function() {
15           // デフォルトのイベントをキャンセル
16               event.preventDefault();
17               // スクロールの速度
18               var speed = 800; // ミリ秒
19               // アンカーの値取得
20               var href= $(this).attr("href");
21              // 移動先を取得
22              var target = $(href == "#" || href == "" ? 'html' : href);
23              // 移動先を数値で取得
24              var position = target.offset().top;
25              // スムーススクロール
26              $('body,html').animate({scrollTop:position}, speed, 'swing');
27              return false;
28               });
29        });
30        &lt;/script>
〜省略〜
                </code></pre>
                <p>
                    こんな感じのコードだった。どこが悪いのか分からなかったのでChromeのデベロッパーツールで表示したところ、二つのエラーが出ていた。<br>
                    <ul>
                        <li>$ is not denied →12行目の$のこと</li>
                        <li>Mixed content →混合コンテンツ</li>
                    </ul>
		    リンク先へスクロールさせるためにまずは７行目でjQueryをインポートするのだが、「httpsの中でhttpを読み込んじゃダメ」っていうのが「Mixed content」らしい。そのせいでjQueryを読み込めないから11行目移行を認識できず、$がエラーになる。7行目のurlを「https://ajax〜」にしたら解決した。<br>
		    <small>（スクロースさせる部分の記述は、ページが増えてきたので別ファイルから読み込むように変更した 02/Feb/2020）</small>
                </p>
                <p>
                    　ちなみに&lt;pre>タグの中にhtmlのコードを書くコツが分かってきた。htmlとして認識されちゃうと表示されなかったり文字化けしたりするので、htmlとかmetaとかscriptの最初のカッコだけエスケープ文字で書けば問題ないみたい。
                </p>
                <a href="./index.html#menu" class="button">目次へ戻る</a><br>
                <a href="#top" class="button">先頭へ</a>
            </div>
<!--python3とapache2でcgiを動かして見る-->
            <div class="menu" id="i9">
                <h3>python3とapache2でcgiを動かしてみる</h3>29/Jan/2020
                <p>
                    　いよいよpythonでcgiを動かす環境を整えてみたいと思いapache2の設定をした。raspbianにaptでapache2をインストールした場合、/etc/apache2/conf-available/serve-cgi-bin.confの設定を書き換える。<br>
                    ちなみに、環境は以下の通り。
                    <ul>
                        <li>Apache2.4</li>
                        <li>Python3.7.3</li>
                    </ul>
                </p>
                <pre class="coding-env"><code>
# /etc/apache2/conf-availalble/serve-cgi-bin.confの一部を編集。
〜省略〜
    10     &lt;IfDefine ENABLE_USR_LIB_CGI_BIN>
            # ↓ScriptAlias /URL上のディレクトリ/ /実際のディレクトリ/   ←最後に/
    11         ScriptAlias /cgi-bin/ /PATH/TO/cgi-bin/
            # ↓Directory "実際のディレクトリ"    ←最後に/なし
    12         &lt;Directory "/PATH/TO/cgi-bin">
    13             AddHandler cgi-script .cgi .py   ←cgiとして動かす拡張子を登録
    14             AllowOverride None
    15             Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
    16             Require all granted
    17         &lt;/Directory>
    18     &lt;/IfDefine>
〜省略〜

# cgidを動かすコマンドを実行（シンボリックリンクを作るらしい）
# そしてapache2を再起動
    $ a2enmod cgid
    $ sudo systemctl restart apache2

# cgiのモジュールを読み込んでいるか確認
    $ apache2ctl -M | grep cgi
    cgid_module (shared)
                </code></pre>
                <p>
                    　そして設定したディレクトリに「cgi-bin」というディレクトリを作り、中に実行ファイルを入れてパーミッションは755にしておく。これでちゃんと動いたが、最初にWebルートティレクトリにcgi-binを置いてしまってセキュリティ上よくない気がしたので、場所を移した。そうしたらパーミッションエラーやタイプミスやいろいろな失敗とともになぜかシンタックスエラーで.pemファイルが読み込めなくなり、２時間ハマった。404とか500なんかのエラーや、cgiのコードがそのまま表示されるなどして苦しんだが、ほとんどタイプミスだった。。。
                </p>
                <p>
                    　今回はhtmlページにフォームを置いて、それを受け取ったcgiが別のページを表示するだけの簡単なサンプルを作成した。
                </p>
                <p>
                Sample：入力した文字を別ページで表示する<br>
                <form action="/cgi-bin/test.py" method="POST">
                    <input type="text" name="text" value="Input here"/>
                    <input type="submit" name="submit"/>
                </form>
                <br>
                <a href="./index.html#menu" class="button">目次へ戻る</a><br>
                <a href="#top" class="button">先頭へ</a>
            </div>
<!--counterを設置する-->
            <div class="menu" id="i10">
                <h3>アクセスカウンタを設置する</h3>31/Jan/2020
                <p>
                    　<mark>python3でcgiを動かす</mark>練習の一環として、アクセスカウンタを作って見ることにした。python2系での資料がネット上にたくさんあるので、まずはそれを参考に作ってみた。まずは単純にアクセス数の数字だけを表示する目的で、テキストファイルを用意して読み書きするようにした。<br>
                    プログラムの流れとしては、
                    <ol>
                        <li>fcntlとcgiのモジュールをimportする</li>
                        <li>ファイルをロックする</li>
                        <li>テキストファイルから数字を読み込む</li>
                        <li>数字をインクリメントする</li>
                        <li>増えた数字を上書き保存する</li>
                        <li>ファイルのロックを解除する</li>
                        <li>新しい数字をhtmlコードに埋め込んで出力する</li>
                    </ol>
                    このような流れで良いと思う。注意点は保存用ファイルのパスの指定を間違わないことと、出力するhtmlコード中の「%s」以外に「%」を使わないこと。様々な間違いで「500 Internal Server Error」が出るので、問題を特定するのが難しかった。忘れがちなのがパーミッションで、自分はWebページのルートディレクトリとは違うところに保存ファイルを置いているのだが、保存ファイルとそのディレクトリも読み書きを許可しておかないとcgiから読んだときにパーミッションエラーになってしまうようだ。気づくまでに結構な時間を費やした。
                </p>
                <p>
                    　実際に動くようになってからもChromeのデベロッパーツールで確認すると404 Errorが出ていた。これはFile Not Foundのエラーだが、カウンタはちゃんと動いている。<br>
                    どういうことかというと、例えばWebページのルートディレクトリの上の階層にdatディレクトリを置いて、その中に保存用count.datファイルを作ったとする。cgiから呼び出すときには相対パスでOKだが、ブラウザから見ると「https://example.com/dat/count.dat」にアクセスしているように見えるので、404になるみたい。<br>
		    今回はアクセ数数を保存するだけなためみられても構わないファイルなので、とりあえずルート以下にdatティレクトリのシンボリックリンクを置いてエラーを消しておいた。<small>(同じ名前のダミーのファイルに変えた 02/Feb/2020)</small>プログラムはこんな感じ。
                </p>
                <pre class="coding-env"><code>
#!/usr/bin/Python3

import fcntl, cgi

# カウントファイルのパス
dat = "PATH/TO/dat/count.dat"
# 表示用html
count_code = """Content-Type:text/html

&lt;html>
&lt;head>
&lt;meta charset="UTF-8"/>
&lt;meta name="viewport" content="width=device-width, initial-scale=1"/>
&lt;style>
body {
    color: white;
    font-size: 1em;
    background-color: rgba(0, 0, 0, 0.5);
    width: 100px;
    margin-left: 5px;
}
&lt;/style>
&lt;title>count&lt;/title>
&lt;/head>
&lt;body>
You are&lt;br>
the %s th&lt;br>
visitor!
&lt;/body>
&lt;/html>
"""

# ファイルを読み込み専門で開く
with open(dat, mode='r') as f:
    # ファイルをロック
    fcntl.flock(f.fileno(), fcntl.LOCK_EX)
    # ファイルを読み込む
    str_count = f.read()

# count.datの中にデータが無い場合の対策
str_count = '0' if len(str_count) == 0 else str_count

# ファイルを上書きモードで開く
with open(dat, mode='w') as f:
    # インクリメント（数字にしてから）
    int_count = int(str_count)
    int_count += 1
    # strにして書き込む
    count = str(int_count)
    f.write(count)
    # ファイルのロックを解除
    fcntl.flock(f.fileno(), fcntl.LOCK_UN)

# htmlを出力
print(count_code % (count))
                </code></pre>
                <p>
                　index.htmlの方からは&lt;iframe>&lt;/iframe>でsrcにcgiのパスを指定し、widthとheight属性で大きさを決めて表示している。
            </p>
            <a href="./index.html#menu" class="button">目次へ戻る</a><br>
            <a href="#top" class="button">先頭へ</a>
            </div>
<!--ここまで全体のスタイルを適用-->
        </div>
    </body>
</html>
